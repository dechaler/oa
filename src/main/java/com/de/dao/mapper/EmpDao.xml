<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.de.dao.EmpDao">
    <!--注册-->
    <insert id="register" parameterType="Employee" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO employee(emp_name, emp_pwd,sex,age,phone,job,iner_date,depart_id)
        VALUES
         <if test="name != null and name != ''">
               (#{name},
         </if>
        <if test="password != null and password != ''">
            #{password},
        </if>
          #{sex},#{age},#{phone}, #{job},#{inerDate}, #{department.id})
    </insert>

    <!--登陆-->
    <select id="login" parameterType="Integer" resultType="String">
        SELECT emp_pwd FROM employee
        WHERE id =#{id}
    </select>

    <!--更新员工信息-->
    <update id="updateEmpById" useGeneratedKeys="true" keyProperty="id">
        UPDATE employee SET sex=#{emp.sex},age=#{emp.age},phone=#{emp.phone},job=#{emp.job},iner_date=#{emp.inerDate},depart_id=#{emp.department.id}
        WHERE id =#{id}
    </update>

    <!--更新员工密码-->
    <update id="updatePwdById">
        UPDATE employee SET emp_pwd = #{newPwd} WHERE id = #{id}
    </update>

    <!--查询全部员工信息Map-->
    <resultMap id="selectEmpMap" type="Employee">
        <id property="id" column="id"/>
        <result property="name" column="emp_name"/>
        <!--<result property="password" column="emp_pwd"/>-->
        <result property="sex" column="sex"/>
        <result property="phone" column="age"/>
        <result property="job" column="job"/>
        <result property="inerDate" column="iner_date"/>
        <association property="department" javaType="Department">
            <id property="id" column="did"/>
            <result property="name" column="depart_name"/>
        </association>
    </resultMap>

    <!--查询全部员工信息）-->
    <select id="selectAllEmp" resultMap="selectEmpMap">
        SELECT e.id,emp_name,emp_pwd, sex,age,phone,iner_date,job,d,id did,d.depart_name
        FROM employee e
                 LEFT JOIN department d ON e.depart_id = d.id
    </select>

    <!--根据id查询员工信息-->
    <select id="selectEmpById" parameterType="Integer" resultMap="selectEmpMap">
        SELECT e.id,emp_name,sex,age,phone,iner_date,job,d.id did,d.depart_name
        FROM employee e
                 LEFT JOIN department d ON e.depart_id = d.id
        WHERE e.id = #{id}
    </select>

    <!--通过员工号或员工名查询员工信息-->
    <select id="selectEmpByIdOrNameOrDepartId" parameterType="String" resultMap="selectEmpMap">
        SELECT e.id,emp_name,emp_pwd, sex,age,phone,iner_date,job,d.depart_name
        FROM employee e
         LEFT JOIN department d ON e.depart_id = d.id
        <where>
            <if test="id != null and id != ''">
            e.id = #{id}
            </if>
            <if test="name != null and name != ''">
                or e.`emp_name` LIKE '%${name}%'
            </if>
            <if test="departId != null and departId != ''">
                or e.`depart_id` = #{departId}
            </if>
        </where>

    </select>


    <!--通过员员工名查询员工信息-->
    <!--<select id="selectEmpByName" resultMap="selectEmpMap">-->
        <!--SELECT e.id,emp_name,emp_pwd, sex,age,phone,iner_date,job,d.depart_name-->
        <!--FROM employee e-->
                 <!--LEFT JOIN department d ON e.depart_id = d.id-->
        <!--WHERE e.`emp_name` LIKE '%${name}%'-->
    <!--</select>-->
    <!--通过部门号查询部门信息-->

    <!--<select id="selectDepartByDepartId">-->
    <!--</select>-->

    <!--查询所有员工号-->
    <select id="selectAllEmpId" resultType="Integer">
        SELECT DISTINCT id FROM employee order by id;
    </select>
</mapper>